<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=generator content="Hugo 0.92.2">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="cavefxa">
<meta property="og:url" content="https://cavefxa.com/posts/cve-2022-45291/">
<link rel=canonical href=https://cavefxa.com/posts/cve-2022-45291/><link rel=alternate type=application/atom+xml href=https://cavefxa.comindex.xml title=cavefxa>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/cavefxa.com"},"articleSection":"posts","name":"PWS_Dashboard - CVE-2022-45291: \u0022badweather\u0022","headline":"PWS_Dashboard - CVE-2022-45291: \u0022badweather\u0022","description":"Some weeks ago now, my good friend Mikbrosim, and I were sitting a sunday evening looking for something we could hack. After searching the internet for a while, I found some really old looking site. The site had some webcam, of what looked like a private backyard (publicly exposed of course), and some sort of weather dashboard. Looking around on the site a bit, it seemed really odd, and broken; however nothing was to be found, and we obviously didn\u0026rsquo;t want to pentest something we didn\u0026rsquo;t have permissions to.","inLanguage":"en-US","author":"cavefxa","creator":"cavefxa","publisher":"cavefxa","accountablePerson":"cavefxa","copyrightHolder":"cavefxa","copyrightYear":"2022","datePublished":"2022-12-20 19:49:35 \u002b0100 CET","dateModified":"2022-12-20 19:49:35 \u002b0100 CET","url":"https:\/\/cavefxa.com\/posts\/cve-2022-45291\/","keywords":[]}</script>
<title>PWS_Dashboard - CVE-2022-45291: "badweather"</title>
<meta property="og:title" content="PWS_Dashboard - CVE-2022-45291: &#34;badweather&#34;">
<meta property="og:type" content="article">
<meta property="og:description" content="Some weeks ago now, my good friend Mikbrosim, and I were sitting a sunday evening looking for something we could hack. After searching the internet for a while, I found some really old looking site. The site had some webcam, of what looked like a private backyard (publicly exposed of course), and some sort of weather dashboard. Looking around on the site a bit, it seemed really odd, and broken; however nothing was to be found, and we obviously didn&amp;rsquo;t want to pentest something we didn&amp;rsquo;t have permissions to.">
<meta name=description content="Some weeks ago now, my good friend Mikbrosim, and I were sitting a sunday evening looking for something we could hack. After searching the internet for a while, I found some really old looking site. The site had some webcam, of what looked like a private backyard (publicly exposed of course), and some sort of weather dashboard. Looking around on the site a bit, it seemed really odd, and broken; however nothing was to be found, and we obviously didn&amp;rsquo;t want to pentest something we didn&amp;rsquo;t have permissions to.">
<meta property="og:locale" content="en-us"><meta property="og:image" content>
<style>body{font-family:bree serif,sans-serif;-webkit-font-smoothing:antialiased;margin:0 20px}article{max-width:900px;margin-left:auto;margin-right:auto}a{color:#000;text-decoration:none}a:hover{font-weight:600;text-decoration:underline}.post-ads{margin:50px 0}.markdown-body{font-size:18px;max-width:100%}.markdown-body a{text-decoration:underline;text-decoration-color:#000}.markdown-body blockquote{margin:0;padding:0 1em;color:#57606a;border-left:.25em solid #d0d7de}.markdown-body pre{padding:16px;overflow:auto;border-radius:10px}pre{.l { color: #000000 !important; }}.markdown-body code{padding:.2em .4em;font-size:85%;color:#43494d;border-radius:6px}.highlight pre{background-color:#fff!important}.markdown-body pre>code{padding:0;font-size:100%;color:#171b1f;background-color:inherit;border:0}.Chinese .markdown-body{line-height:200%}.site-date-catalog{font-size:2rem}.header-title{font-size:2rem;font-weight:700;margin-top:32px;font-family:bungee shade,sans-serif}.header-title a{text-decoration:none}.header-subtitle{color:#666}.header-items{margin:10px 0}.header-item{margin:0 5px}.header-line{width:100%;border-width:2px;border-color:#482936;border-style:solid none none none}.lang-switch{font-weight:600}#posts-list{min-height:600px}.posts-line{font-size:1.2rem;margin:12px 0}.posts-categories{font-size:.8rem;margin:auto;text-align:center}.posts-category{padding:3px 0;border:#000 2px solid;border-radius:5px}.site-footer{margin-top:50px}.site-footer-item{margin-right:12px}.post-content img{max-width:100%;display:block;margin-right:auto;margin-top:12px}.post-header{margin-bottom:50px}.post-title{font-size:2rem;font-weight:600}.post-tags{display:inline;font-weight:600;padding:2px 5px;margin-right:6px;border:#000 2px solid;border-radius:5px}.post-date{font-weight:800;font-style:italic}.post-author{float:right;font-weight:600}.page-content{min-height:60%}.post-content{margin-bottom:50px}.post-content p{hyphens:auto;line-height:1.8;text-justify:ideographic;margin-bottom:1em}.related-content{border-width:3px;border-style:solid;border-color:#000;padding:0 10px;margin-bottom:50px;margin-top:100px}.related-content li{margin:5px 0}.taxonomy-term{font-size:3rem}.gallery-img{text-align:center}.gallery-img span{text-align:center}.gallery-img-desc{font-size:.8em;font-weight:800}#disqus_thread{position:relative}#disqus_thread:after{content:"";display:block;height:55px;width:100%;position:absolute;bottom:0;background:#fff}@media screen and (max-width:600px){.header-title,.header-subtitle,.header-items{text-align:center}.posts-line{font-size:16px}.markdown-body{font-size:16px}.post-title{font-size:2rem}.post-content p{letter-spacing:.05em}}@media screen and (max-width:48em){.posts-category{display:none}}</style>
<style>.container,.container-fluid{margin-right:auto;margin-left:auto}.container-fluid{padding-right:2rem;padding-left:2rem}.row{box-sizing:border-box;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:0;-ms-flex:0 1 auto;flex:initial;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-.5rem;margin-left:-.5rem}.row.reverse{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.col.reverse{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.col-xs,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9,.col-xs-offset-0,.col-xs-offset-1,.col-xs-offset-10,.col-xs-offset-11,.col-xs-offset-12,.col-xs-offset-2,.col-xs-offset-3,.col-xs-offset-4,.col-xs-offset-5,.col-xs-offset-6,.col-xs-offset-7,.col-xs-offset-8,.col-xs-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-xs{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-xs-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-xs-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-xs-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-xs-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-xs-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-xs-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-xs-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-xs-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-xs-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-xs-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-xs-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-xs-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-xs-offset-0{margin-left:0}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-11{margin-left:91.66666667%}.start-xs{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-xs{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-xs{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-xs{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-xs{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-xs{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-xs{-ms-flex-pack:distribute;justify-content:space-around}.between-xs{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-xs{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-xs{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}@media only screen and (min-width:48em){.container{width:49rem}.col-sm,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-offset-0,.col-sm-offset-1,.col-sm-offset-10,.col-sm-offset-11,.col-sm-offset-12,.col-sm-offset-2,.col-sm-offset-3,.col-sm-offset-4,.col-sm-offset-5,.col-sm-offset-6,.col-sm-offset-7,.col-sm-offset-8,.col-sm-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-sm{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-sm-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-sm-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-sm-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-sm-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-sm-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-sm-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-sm-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-sm-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-sm-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-sm-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-sm-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-sm-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-sm-offset-0{margin-left:0}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-11{margin-left:91.66666667%}.start-sm{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-sm{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-sm{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-sm{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-sm{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-sm{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-sm{-ms-flex-pack:distribute;justify-content:space-around}.between-sm{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-sm{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-sm{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:64em){.container{width:65rem}.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-offset-0,.col-md-offset-1,.col-md-offset-10,.col-md-offset-11,.col-md-offset-12,.col-md-offset-2,.col-md-offset-3,.col-md-offset-4,.col-md-offset-5,.col-md-offset-6,.col-md-offset-7,.col-md-offset-8,.col-md-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-md{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-md-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-md-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-md-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-md-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-md-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-md-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-md-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-md-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-md-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-md-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-md-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-md-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-md-offset-0{margin-left:0}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-3{margin-left:25%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-6{margin-left:50%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-9{margin-left:75%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-11{margin-left:91.66666667%}.start-md{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-md{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-md{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-md{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-md{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-md{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-md{-ms-flex-pack:distribute;justify-content:space-around}.between-md{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-md{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-md{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:75em){.container{width:76rem}.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-offset-0,.col-lg-offset-1,.col-lg-offset-10,.col-lg-offset-11,.col-lg-offset-12,.col-lg-offset-2,.col-lg-offset-3,.col-lg-offset-4,.col-lg-offset-5,.col-lg-offset-6,.col-lg-offset-7,.col-lg-offset-8,.col-lg-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-lg{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-lg-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-lg-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-lg-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-lg-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-lg-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-lg-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-lg-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-lg-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-lg-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-lg-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-lg-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-lg-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-lg-offset-0{margin-left:0}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-11{margin-left:91.66666667%}.start-lg{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-lg{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-lg{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-lg{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-lg{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-lg{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-lg{-ms-flex-pack:distribute;justify-content:space-around}.between-lg{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-lg{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-lg{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}</style>
<link href=/index.xml rel=alternate type=application/rss+xml title=cavefxa>
<link rel=preconnect href=https://fonts.gstatic.com>
<link href="https://fonts.googleapis.com/css?family=Bree+Serif|Bungee+Shade" rel=stylesheet>
</head>
<body>
<article class=post id=article>
<div class=row>
<div class=col-xs-12>
<div class=site-header>
<header>
<div class=header-title>
<a href=/>cavefxa</a>
</div>
<div class=header-subtitle></div>
</header>
<div class="row end-md center-xs header-items">
<div class=header-item>
<a href=/index.xml target=_blank>RSS</a>
</div>
</div>
<div class="row end-xs">
</div>
<div class=header-line></div>
</div>
<header class=post-header>
<h1 class=post-title>PWS_Dashboard - CVE-2022-45291: "badweather"</h1>
<div class="row post-desc">
<div class=col-xs-6>
<time class=post-date datetime="2022-12-20 19:49:35 CET">
20 Dec 2022
</time>
</div>
<div class=col-xs-6>
<div class=post-author>
<a target=_blank href=https://cavefxa.com/>@cavefxa</a>
</div>
</div>
</div>
</header>
<div class="post-content markdown-body">
<p>Some weeks ago now, my good friend Mikbrosim, and I were sitting a sunday evening looking for something we could hack. After searching the internet for a while, I found some really old looking site. The site had some webcam, of what looked like a private backyard (publicly exposed of course), and some sort of weather dashboard. Looking around on the site a bit, it seemed really odd, and broken; however nothing was to be found, and we obviously didn&rsquo;t want to pentest something we didn&rsquo;t have permissions to. Suddenly I found at the bottom a &ldquo;Template by PWS_Dashboard&rdquo;, link that linked directly to the source code! Score! So we quickly downloaded the source down, and started having a look.</p>
<h1 id=stage-1-recon>Stage 1. Recon</h1>
<p>So firstly we wanted to find out, what this actually was, and who used it? It seemed to be a &ldquo;Personal Weather Station Dashboard&rdquo;, used by hobby meteorologists, or just people that wanted to get information about weather near them. This would be done by having your own weatherstation, and then you could upload to the dashboard and see the data, it&rsquo;s probably also possible to use some other peoples data, and just display this. Regardless, the weatherstations are very expensive, wouldn&rsquo;t be good if people came in and totally bricked them by running shady code on your server.</p>
<p><img src=/pictures/dc9d458a999214120f9c8bdac028b14af708e32a0d4e396dd0260a1532b2dca3.png alt=Amazon></p>
<p>The site had the following text</p>
<pre tabindex=0><code>Downloads: Click here to download the latest full version .
All published updates up to **March 28, 2022** are included in the download.
New in this update: Multi (4) language setup and compatabillity tested with PHP 8.1.4
</code></pre><p>That lead us to believe, that even though this software was very old-looking, it was still being used, and maintained by some hobby developers. They even have a forum over at <a href=https://www.weather-watch.com/smf/index.php/board,77.0.html>https://www.weather-watch.com/smf/index.php/board,77.0.html</a> which is pretty active. It wasn&rsquo;t possible for us to get a good estimate, of how many servers were running this software, shodan only gave us a handful, but a simple google dork, yielded in the ballpark of around 60-70 users. Now imagine if every one of these users were running a setup with a custom camera and a 200$ weather station. That&rsquo;s a lot of damage (Potentially 12k USD). While that&rsquo;s interesting and all, you&rsquo;re probably here for the technical write-up, not these shenanigans, so let&rsquo;s dive in.</p>
<h1 id=stage-2-code-analysis>Stage 2. Code analysis</h1>
<p>We&rsquo;d like to say that we did something extremely smart, and that this was a very difficult vulnerability to find, but it was a giant pool of poor authentication, and bad access management. Users got to have a bit too much fun on other peoples sites. We opened it up, and to our surprise (not) it was PHP. With a bit to look through.
<img src=/pictures/c1b4c0d8d9cb3bb57b180327ff9a04493fcdcf3c99c26f199b9c1313567db85e.png alt=Unzipped></p>
<p>Now we went ahead and tried getting a local environment to work, so that we had something to test on. To do this we ran a few commands, this was kind of dependent on which dependencies we were missing individually, specifically I ran:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo apt install php-curl
sudo apt install php-simplexml
php -S localhost:8899
</code></pre></div><p>and the site was running on my localhost. Upon visiting the URL we saw, that the setup process had now begun, along with some information about what dependencies were missing, this is how we found out which packages to install. We got it working reasonably quickly, so there was no reason for us to set up a docker instance.
Following the setup manual, we find that the default password is set as 12345, however it&rsquo;s quite explicitly stated, that this is a weak password, and that it should be changed. For the sake of the write-up, we change the password to 0dayR3S4RCH!. This will probably be important later;)
Now we want to find out which attack surfaces there are, this could be input fields, places with database interactions, or GET and POST request handling. We started by just playing a bit around with the website, seeing if we can find something odd.</p>
<p><img src=/pictures/17f9bc90a73606779a20eec73713baf05a5890bb8ab6038e59f1090547f1ddc8.png alt=Page></p>
<h2 id=vulnerability-1---bad-hash>Vulnerability 1 - Bad hash</h2>
<p>At the endpoint http://localhost:8899/PWS_easyweathersetup.php we have a log-in page, now we could of-course try just enumerating weak PWS_Dashboard servers and trying the default password here, and it&rsquo;s probably not unrealistic, that we&rsquo;ll get through on atleast one poorly configured server, but that&rsquo;s not fun. The log-in part of this endpoint looks like:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#00f>if</span> (isset($_POST[<span style=color:#a31515>&#39;submit_pwd&#39;</span>]))
     {  <span style=color:#00f>if</span> (isset($_POST[<span style=color:#a31515>&#39;passwd&#39;</span>]) ) {$pass = $_POST[<span style=color:#a31515>&#39;passwd&#39;</span>]; } <span style=color:#00f>else</span> {$pass = <span style=color:#a31515>&#39;&#39;</span>;} 
        <span style=color:#00f>if</span> ($pass != $password) 
             {  showForm(<span style=color:#a31515>&#39;&lt;b style=&#34;color: red;&#34;&gt;A valid password needs to be entered&lt;/b&gt;&#39;</span>);   
                <span style=color:#00f>exit</span>;}
        } 
<span style=color:#00f>elseif</span> (!isset($_POST[<span style=color:#a31515>&#39;submit&#39;</span>]) )
     {  showForm(<span style=color:#a31515>&#39;PWS_Dashboard setup (version 2012_lts)&#39;</span>); 
        <span style=color:#00f>exit</span>; }
<span style=color:#00f>if</span> (isset($_REQUEST[<span style=color:#a31515>&#39;lang&#39;</span>]) )
     {  $setup_lang = substr(trim($_REQUEST[<span style=color:#a31515>&#39;lang&#39;</span>]).<span style=color:#a31515>&#39;  &#39;</span>,0,2);}
<span style=color:#00f>else</span> {  $setup_lang = <span style=color:#a31515>&#39;en&#39;</span>;}
</code></pre></div><p>We see that if the POST parameter <code>submit_pwd</code> is set, then it checks for the parameter <code>passwd</code>, it wants this <code>pass</code> to be equal to <code>password</code>, which is the correct password. Now we&rsquo;re not really PHP programmers, so we couldn&rsquo;t see anything too horrendous about this. We however now have a few pieces of interesting information, we know that the programmer used <code>submit_pwd</code>, for submitting log-ins and passwd for password parameters. We try grepping for these.</p>
<p><img src=/pictures/e0310a9f1244e3560cd83af461162549f1fea7c90e5d49e7df3b26d64909d605.png alt=submit_pwd_files></p>
<p>We have four files with submit_pwd, looking through, we quickly see something that should probably not have been added to the code.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:green># PWS_winter.php - omitted for brevity
</span><span style=color:green></span><span style=color:#00f>if</span> (isset($_POST[<span style=color:#a31515>&#39;submit_pwd&#39;</span>]))
     {  <span style=color:#00f>if</span> (isset($_REQUEST[<span style=color:#a31515>&#39;passwd&#39;</span>]) ) {$pass = $_REQUEST[<span style=color:#a31515>&#39;passwd&#39;</span>]; } <span style=color:#00f>else</span> {$pass = <span style=color:#a31515>&#39;&#39;</span>;}
        <span style=color:#00f>if</span> ($pass != $password &amp;&amp; !password_verify($pass, <span style=color:#a31515>&#39;$2y$10$S1K2rXeaAihG2Ro2lBxh2e7UfMXht3RkocukvxKRzDFXqx4dJND5i&#39;</span>) )
             {  <span style=color:#00f>echo</span> $html;
                showForm(<span style=color:#a31515>&#39;&lt;b style=&#34;color: red;&#34;&gt;We need a valid password&lt;/b&gt;&#39;</span>);
                <span style=color:#00f>exit</span>;}
        }
</code></pre></div><p>We see that it checks if we&rsquo;re trying to submit password, it first checks if our parameter matches the password, set originally, and then it checks if your password matches the hash that obviously has been hardcoded into the code. This means that if we manage to bruteforce this hash and insert that as a request we&rsquo;d have a line that says:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#00f>if</span> (<span style=color:#00f>true</span> &amp;&amp; !<span style=color:#00f>true</span>){ <span style=color:#00f>exit</span>; }
</code></pre></div><p>This will never exit. If we manage to get the plaintext value for the hash, we&rsquo;ll be allowed in to the PWS_winter.php site, but why is that interesting? Well for starters we have a line that says:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>&lt;input type=<span style=color:#a31515>&#34;hidden&#34;</span> style=<span style=color:#a31515>&#34;padding: 0px; border: 0px; margin: 0px;&#34;</span> name=<span style=color:#a31515>&#34;passwd&#34;</span> value=<span style=color:#a31515>&#34;&#39;.$password.&#39;&#34;</span>&gt;&#39;;
</code></pre></div><p>And the $password parameter hasn&rsquo;t been overwritten. For some reason this is on the site? Logging in would leak the real password. We originally tried bruteforcing it, but then we thought, meh it&rsquo;s probably in rockyou.txt.</p>
<p>We figured out it was a bcrypt hash, which we also could find out by running the <code>hashid</code> command on the file containing the hash. Then we ran the corresponding hashcat command.
<code>hashcat -m 3200 -a 0 hash rockyou.txt</code>.</p>
<p>After just 8 minutes on a quite weak <code>Intel(R) Core(TM) i5-7200U CPU @ 2.50GHz</code> we have
the password, which is the password <code>support</code></p>
<pre tabindex=0><code>$2y$10$S1K2rXeaAihG2Ro2lBxh2e7UfMXht3RkocukvxKRzDFXqx4dJND5i:support

Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 3200 (bcrypt $2*$, Blowfish (Unix))
Hash.Target......: $2y$10$S1K2rXeaAihG2Ro2lBxh2e7UfMXht3RkocukvxKRzDFX...dJND5i
Time.Started.....: Tue Nov  8 17:09:10 2022 (8 mins, 0 secs)
Time.Estimated...: Tue Nov  8 17:17:10 2022 (0 secs)
</code></pre><p>And truth be told, logging into the PWS_winter.php site, yields the password.
<img src=/pictures/c606a25db2ff2409fe156bfa767ac7e8c51124782b8f5370314d6c0cd298a2f9.png alt="Password Leak"></p>
<p>This is a pretty good find, and it&rsquo;s not depicted anywhere in the installation guide or documentation, that this should be changed. Meaning this will be default on all instances of PWS_Dashboard, unless someone found this themselves, changed it, and never bothered telling anyone. That&rsquo;s one vulnerability. A few to go.</p>
<hr>
<h2 id=vulnerability-2---limited-file-read>Vulnerability 2 - Limited file read</h2>
<p>Another interesting vulnerability is located in the endpoint /PWS_listfile.php</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#00f>if</span> (isset ($_REQUEST[<span style=color:#a31515>&#39;file&#39;</span>])) {$file   = trim($_REQUEST[<span style=color:#a31515>&#39;file&#39;</span>]);}
<span style=color:#00f>if</span> (isset ($_REQUEST[<span style=color:#a31515>&#39;type&#39;</span>]))
     {  $in     = trim($_REQUEST[<span style=color:#a31515>&#39;type&#39;</span>]);
        <span style=color:#00f>if</span> (in_array ($in,$types) ) {$type = $in;} }
<span style=color:#00f>if</span> (strpos($file,<span style=color:#a31515>&#39;settings.php&#39;</span>) || strpos($file,<span style=color:#a31515>&#39;twitter_keys.php&#39;</span>))
     {  <span style=color:#00f>if</span> (!array_key_exists(<span style=color:#a31515>&#39;pw&#39;</span>,$_REQUEST) ) {<span style=color:#00f>die</span> (<span style=color:#a31515>&#39;Security error&#39;</span>);}
        <span style=color:#00f>include</span> <span style=color:#a31515>&#39;PWS_settings.php&#39;</span>;
        $pw     = trim($_REQUEST[<span style=color:#a31515>&#39;pw&#39;</span>]);
        <span style=color:#00f>if</span> ($pw &lt;&gt; $password &amp;&amp; !password_verify($pw, <span style=color:#a31515>&#39;$2y$10$S1K2rXeaAihG2Ro2lBxh2e7UfMXht3RkocukvxKRzDFXqx4dJND5i&#39;</span>)) {<span style=color:#00f>die</span> (<span style=color:#a31515>&#39;Security error&#39;</span>);}
} <span style=color:green>// check validity request
</span><span style=color:green></span>$string = file_get_contents ($file);
</code></pre></div><p>This takes a file parameter in the GET request, and then it takes a file, we can&rsquo;t read the twitter_keys.php file or the settings.php file, unless we give the hashed password, support. Then we can. This will again leak the real password.</p>
<p><img src=/pictures/f8e399f5bbd5b30524c9b421fb6647742296ab27c72e2b69892ddb9919240133.png alt=Leak_Curl></p>
<p>However without the password, the user can read all files on the system, that the process can. That means leaking <code>/etc/passwd</code>, and all the other very interesting files. Keep in mind that this is not LFI, because it&rsquo;s file_get_contents, which doesn&rsquo;t include anything, simply reads the file, so this would be classified as directory traversal. That&rsquo;s the second vulnerability, onto the third.</p>
<hr>
<h2 id=vulnerability-3---full-file-read-pt-1>Vulnerability 3 - Full file read (pt. 1)</h2>
<p>A couple of days after we initially finished looking at the library, Mikbrosim found another file read, in the endpoint called <code>/PWS_frame_text.php</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#00f>if</span> (isset ($_REQUEST[<span style=color:#a31515>&#39;showtext&#39;</span>]) &amp;&amp; $_REQUEST[<span style=color:#a31515>&#39;showtext&#39;</span>] &lt;&gt; <span style=color:#a31515>&#39;&#39;</span> )
     {  $link   = trim($_REQUEST[<span style=color:#a31515>&#39;showtext&#39;</span>]); }

<span style=color:#00f>if</span> (isset ($_REQUEST[<span style=color:#a31515>&#39;type&#39;</span>]) &amp;&amp; $_REQUEST[<span style=color:#a31515>&#39;type&#39;</span>] &lt;&gt; <span style=color:#a31515>&#39;&#39;</span> )
     {  $param  = trim($_REQUEST[<span style=color:#a31515>&#39;type&#39;</span>]);
        <span style=color:#00f>if</span> ($param &lt;&gt; <span style=color:#a31515>&#39;url&#39;</span>) {$param = <span style=color:#a31515>&#39;file&#39;</span>;}
        $type   = $param;}

<span style=color:#00f>if</span> ($type == <span style=color:#a31515>&#39;url&#39;</span>)    <span style=color:green>#     &#39;https://tgftp.nws.noaa.gov/data/raw/cd/cdus41.klwx.cli.bwi.txt&#39;;
</span><span style=color:green></span>      { $ch             = curl_init();
        curl_setopt($ch, CURLOPT_URL,$link);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span style=color:#00f>true</span>);
        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span style=color:#00f>false</span>);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span style=color:#00f>false</span>);
        curl_setopt($ch, CURLOPT_FOLLOWLOCATION, <span style=color:#00f>true</span>);
        curl_setopt($ch, CURLOPT_CONNECTTIMEOUT,10); <span style=color:green>// connection timeout
</span><span style=color:green></span>        curl_setopt($ch, CURLOPT_TIMEOUT,20);        <span style=color:green>// data timeout 30 seconds
</span><span style=color:green></span>        $result = curl_exec ($ch);
        $info   = curl_getinfo($ch);
        $error  = curl_error($ch);
        curl_close ($ch);    }
<span style=color:#00f>else</span> {  $result         = file_get_contents ( $link);}
</code></pre></div><p>We can use this to arbitrary file read, because this doesn&rsquo;t check if we&rsquo;ve set a password.</p>
<p><img src=/pictures/dea211988316b4527f8bb44c98b1a71d689902ee51aedfee6ddfe93148a610e4.png alt=No_Unauth_LFI></p>
<h2 id=vulnerability-4---full-file-read-pt-2>Vulnerability 4 - Full File Read (pt. 2)</h2>
<p>We found another full file read in the <code>PWS_printfile.php</code> endpoint, that just allows for printing arbitrary files.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#00f>if</span> (isset ($_REQUEST[<span style=color:#a31515>&#39;file&#39;</span>]) )  <span style=color:green>// we need to now the link to the file
</span><span style=color:green></span>     {  $file   = trim($_REQUEST[<span style=color:#a31515>&#39;file&#39;</span>]);}
<span style=color:#00f>else</span> {  $file   = $livedata;}
<span style=color:green>#
</span><span style=color:green></span><span style=color:#00f>if</span> (!file_exists ($file) )
     {  <span style=color:#00f>echo</span> __LINE__.<span style=color:#a31515>&#39; no file &#39;</span>.$file.<span style=color:#a31515>&#39; found&#39;</span>; <span style=color:#00f>return</span>;}
<span style=color:#00f>else</span> {  $data = file_get_contents ($file);
        <span style=color:#00f>if</span> ($data  == <span style=color:#00f>false</span>)
             {  <span style=color:#00f>echo</span> __LINE__.<span style=color:#a31515>&#39; no file or empty file &#39;</span>.$file.<span style=color:#a31515>&#39; found&#39;</span>; <span style=color:#00f>return</span>;}
}   <span style=color:green>// eo check file exists and is usable
</span><span style=color:green>#
</span><span style=color:green></span><span style=color:#00f>if</span> (isset ($_REQUEST[<span style=color:#a31515>&#39;showall&#39;</span>]) )
     {  $used_only = <span style=color:#00f>false</span>; }
</code></pre></div><p>This means we can give it a parameter, file, which just will read the file we give it, eg. <code>localhost:8899/PWS_printfile.php?file=/etc/passwd</code></p>
<h2 id=vulnerability-5---remote-code-execution>Vulnerability 5 - Remote Code Execution</h2>
<p>Now we want to take this, and turn it into something more powerful. Quite quickly we see that the settings.php endpoint is vulnerable. We can also edit this file, because we’re now admin, and we can now change the settings. The reason that we can inject PHP directly into this file, is because there’s no input parsing:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>       $stationlocation = <span style=color:#a31515>&#34;A city in Belgium&#34;</span>;
                 $email = <span style=color:#a31515>&#34;someone@dot.com&#34;</span>;
               $twitter = <span style=color:#a31515>&#34;pwsweather&#34;</span>;
              $facebook = <span style=color:#a31515>&#34;pwsweather&#34;</span>;
        $solve_problem1 = <span style=color:#a31515>&#34;not_used&#34;</span>;
        $solve_problem2 = <span style=color:#a31515>&#34;not_used&#34;</span>;
                    $TZ = <span style=color:#a31515>&#34;Europe/Brussels&#34;</span>;
</code></pre></div><p>It&rsquo;s rather trivial to get code execution here, by just simply changing the settings, our input will be injected directly into the settings.php file:
<img src=/pictures/80960dd29a913e0ec544435038bc680ce725f736273a3044f2f8ccf543ea4a8e.png alt=RCE_101></p>
<p>We start (Yellow) by adding a double-quote, and a semi-colon, this is done to end the line in proper PHP fashion, now we can just execute some arbitrary PHP command (Blue), and to end the line (Red), we add a hashtag, because this is how you comment in PHP. We can see this does infact, execute remote code.
<img src=/pictures/5749d6964a913e598970377221451da9837fc5d248a468497ed1f0021a682539.png alt=RCE_in_action></p>
<p>And quite quickly one can get proper full fletched remote code execution. Which could allow us to take control of servers running this software, and run commands on their systems. This could lead to backdoors, ransomware attacks etc.
<img src=/pictures/b3996f63620a7107b847354e43dd203075a6041be45a668e111b7931c7a76238.png alt=ls_lah></p>
<p>To visualize, these are sites, I assume to be vulnerable (of course without testing, but looking at the software version). (57 servers).
<img src=/pictures/5058dd8d966fbf7d7564c6cc7163e27d3c59bf8a04575ecac5ebf26ec079bcb3.png alt=vuln_></p>
<p>This is quite bad.</p>
<h1 id=stage-3-responsible-disclosure>Stage 3. Responsible disclosure</h1>
<p>We started by filing a CVE request to MITRE. In which we disclosed all of the vulnerabilities above. Then we sent mr. Kuil, the main developer of PWS_Dashboard a mail, revolving these vulnerabilities, with some advice on how these could be fixed, along with the same technical description we sent mitre, so that he could reproduce, and check that these issues are indeed present.</p>
<pre tabindex=0><code>What can you do, to fix this?
First, let's start by acknowledging, that it's simply not secure to have this &quot;support&quot; password. Even changing it for a stronger password, will at some point, theoretically allow for access to the panel. Best bet, would be to remove this part of the code, and only rely on the password set by the configurer.

The password currently in the settings, set by the configurer, should also not be shown in plaintext. (...)

You cannot have the function PWS_frame_text.php, show text for files without authentication, this also allows for information disclosure. Same applies for PWS_listfile.php

In the settings page, the following PHP could be applied to all fields, to input sanitize. However some alternative method should probably be applied to the password, as to avoid weak passwords being used. Something like this might help input sanitize, however it's probably not perfect, and just an example:

$result = preg_replace(&quot;/[^a-zA-Z0-9]+/&quot;, &quot;&quot;, $s);
(...)
</code></pre><p>We created a mini-timeline:</p>
<p><img src=/pictures/respdisclosure.png alt=Timeline></p>
<p>Conclusion, we managed to get the issue largely fixed, within a day, and the maintainer was very professional in handling the issue. Our correspondance was mainly messages through the forum for PWS_Dashboard, where we told him what to fix, and gave him concrete advices on how to do so.</p>
</div>
<div class="row middle-xs">
<div class=col-xs-12>
</div>
</div>
<div class=row>
<div class=col-xs-12>
</div>
</div>
<div style=height:50px></div>
<div class=site-footer>
</div>
</div>
</div>
</article>
<script></script>
</body>
</html>